{"remainingRequest":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/ModalPanel/Lottery.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/ModalPanel/Lottery.vue","mtime":1611227050000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":1584009001591},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/babel-loader/lib/index.js","mtime":1615566678361},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":1584009001591},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js","mtime":1615566687412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IGV2ZW50RW1pdHRlciA9IEJKWS5ldmVudEVtaXR0ZXI7CmNvbnN0IGF1dGggPSBCSlkuYXV0aDsKCmV4cG9ydCBkZWZhdWx0IHsKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdmlzaWJsZTogZmFsc2UsCiAgICAgIGNvbW1hbmRMb3R0ZXJ5RHVyYXRpb246IDAsCiAgICAgIGxvdHRlcnlUaW1lcjogbnVsbCwKICAgICAgaXNTdHVkZW50OiBhdXRoLmlzU3R1ZGVudCgpLAogICAgICBsb3R0ZXJ5Q29tbWFuZDogIiIsCiAgICAgIGxvdHRlcnk6IG51bGwsCiAgICB9OwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIEJKWS5Mb3R0ZXJ5LmluaXQoKTsKICAgIGV2ZW50RW1pdHRlcgogICAgICAub24oZXZlbnRFbWl0dGVyLkxPVFRFUllfSElTVE9SWV9SRVMsIChldmVudCwgZGF0YSkgPT4gewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgICQoIiNsb3R0ZXJ5IikuaGlkZSgpOwogICAgICAgICQoIiNsb3R0ZXJ5LWhpc3RvcnkiKS5zaG93KCk7CiAgICAgICAgLy8g5p+l55yL5Lit5aWW57qq5b2VCiAgICAgICAgdmFyIGhpc3RvcnlDb21wb25lbnQgPSBCSlkuTG90dGVyeUhpc3RvcnkuY3JlYXRlKHsKICAgICAgICAgIHJlcGxhY2U6IGZhbHNlLAogICAgICAgICAgZWxlbWVudDogJCgiI2xvdHRlcnktaGlzdG9yeSAucGxhY2Vob2xkZXIiKSwKICAgICAgICAgIGxpc3Q6IGRhdGEuaGlzdG9yeSwKICAgICAgICAgIHJvb21JZDogK0JKWS5zdG9yZS5nZXQoImNsYXNzLmlkIiksCiAgICAgICAgfSk7CiAgICAgIH0pCiAgICAgIC8vICAg5qCH5YeG5oq95aWWCiAgICAgIC5vbihldmVudEVtaXR0ZXIuU1RBTkRBUkRfTE9UVEVSWV9CRUdJTiwgKCkgPT4gewogICAgICAgIHRoaXMuc2hvdygpOwogICAgICB9KQogICAgICAub24oZXZlbnRFbWl0dGVyLlNUQU5EQVJEX0xPVFRFUllfQkVHSU5fVFJJR0dFUiwgKCkgPT4gewogICAgICAgICQoIiNsb3R0ZXJ5IikuaGlkZSgpOwogICAgICB9KQogICAgICAub24oZXZlbnRFbWl0dGVyLlNUQU5EQVJEX0xPVFRFUllfRU5ELCAoZXZlbnQsIGRhdGEpID0+IHsKICAgICAgICB0aGlzLnNob3coKTsKICAgICAgICB0aGlzLmNyZWF0ZUhpdExpc3QoZGF0YSk7CiAgICAgIH0pCiAgICAgIC8vIOWPo+S7pOaKveWllgogICAgICAub24oZXZlbnRFbWl0dGVyLkNPTU1BTkRfTE9UVEVSWV9BQk9SVCwgKGV2ZW50LCBkYXRhKSA9PiB7CiAgICAgICAgdGhpcy5zaG93KCk7CiAgICAgICAgdGhpcy5jcmVhdGVIaXRMaXN0KGRhdGEpOwogICAgICB9KQogICAgICAub24oZXZlbnRFbWl0dGVyLkNPTU1BTkRfTE9UVEVSWV9FTkRfVFJJR0dFUiwgKGV2ZW50LCBkYXRhKSA9PiB7CiAgICAgICAgdGhpcy5jb21tYW5kTG90dGVyeUR1cmF0aW9uID0gMDsKICAgICAgICAkKCIjbG90dGVyeSIpLmhpZGUoKTsKICAgICAgICBjb25zb2xlLmxvZygiY29tbWFuZCBsb3R0ZXJ5IGVuZC4iKTsKICAgICAgfSkKICAgICAgLm9uKGV2ZW50RW1pdHRlci5DT01NQU5EX0xPVFRFUllfQkVJR0lOLCAoZSwgZGF0YSkgPT4gewogICAgICAgICQoIiNsb3R0ZXJ5IikuaGlkZSgpOwogICAgICAgIHRoaXMuc2hvdygpOwogICAgICAgIGNvbnNvbGUubG9nKGRhdGEpOwogICAgICAgIHRoaXMuY29tbWFuZExvdHRlcnlEdXJhdGlvbiA9IGRhdGEuZHVyYXRpb247CiAgICAgICAgdGhpcy5sb3R0ZXJ5Q29tbWFuZCA9IGRhdGEuY29tbWFuZDsKICAgICAgICBpZiAodGhpcy5sb3R0ZXJ5VGltZXIpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5sb3R0ZXJ5VGltZXIpOwogICAgICAgICAgdGhpcy5sb3R0ZXJ5VGltZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgICB0aGlzLmxvdHRlcnlUaW1lciA9IHNldEludGVydmFsKCgpID0+IHsKICAgICAgICAgIGlmICh0aGlzLmNvbW1hbmRMb3R0ZXJ5RHVyYXRpb24gPiAwKSB7CiAgICAgICAgICAgIC0tdGhpcy5jb21tYW5kTG90dGVyeUR1cmF0aW9uOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYXV0aC5pc1RlYWNoZXIoKSAmJiB0aGlzLmRyYXdMb3R0ZXJ5KCk7CiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5sb3R0ZXJ5VGltZXIpOwogICAgICAgICAgICB0aGlzLmxvdHRlcnlUaW1lciA9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgfSwgMTAwMCk7CiAgICAgIH0pCiAgICAgIC5vbigidG9nZ2xlX2xvdHRlcnkiLCAoKSA9PiB7CiAgICAgICAgdGhpcy52aXNpYmxlID0gIXRoaXMudmlzaWJsZTsKICAgICAgICB0aGlzLmNyZWF0ZUxvdHRlcnkoKTsKICAgICAgfSk7CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5jcmVhdGVMb3R0ZXJ5KCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICBjbG9zZSgpIHsKICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7CiAgICAgICQoIiNsb3R0ZXJ5Iikuc2hvdygpOwogICAgICAkKCIjbG90dGVyeS1oaXN0b3J5IikuaGlkZSgpOwogICAgfSwKICAgIHNob3coKSB7CiAgICAgIHRoaXMudmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgLy8g5Y+j5Luk5byA5aWWCiAgICBkcmF3TG90dGVyeSgpIHsKICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmxvdHRlcnlUaW1lcik7CiAgICAgIHRoaXMubG90dGVyeVRpbWVyID0gbnVsbDsKICAgICAgdGhpcy5jb21tYW5kTG90dGVyeUR1cmF0aW9uID0gMDsKICAgICAgZXZlbnRFbWl0dGVyLnRyaWdnZXIoZXZlbnRFbWl0dGVyLkNPTU1BTkRfTE9UVEVSWV9BQk9SVF9UUklHR0VSKTsKICAgIH0sCiAgICAvLyDkuK3lpZblkI3ljZUKICAgIGNyZWF0ZUhpdExpc3QoZGF0YSkgewogICAgICAkKCIjbG90dGVyeSIpLmhpZGUoKTsKICAgICAgJCgiI2xvdHRlcnktaGl0Iikuc2hvdygpOwogICAgICB2YXIgaGl0Q29tcG9uZW50ID0gQkpZLkxvdHRlcnlIaXQuY3JlYXRlKHsKICAgICAgICBlbGVtZW50OiAkKCIjbG90dGVyeS1oaXQgLnBsYWNlaG9sZGVyIiksCiAgICAgICAgbGlzdDogZGF0YS5oaXRMaXN0LAogICAgICAgIHJlcGxhY2U6IGZhbHNlLAogICAgICAgIGxvdHRlcnlOYW1lOiBkYXRhLmxvdHRlcnlOYW1lLAogICAgICAgIG9uQ2xvc2U6ICgpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJsb3R0ZXJ5IGNsb3NlLiIpOwogICAgICAgICAgJCgiI2xvdHRlcnktaGl0IikuaGlkZSgpOwogICAgICAgICAgJCgiI2xvdHRlcnkiKS5zaG93KCk7CiAgICAgICAgICB0aGlzLmNsb3NlKCk7CiAgICAgICAgfSwKICAgICAgICAvLyDkuK3lpZbogIXloavlhpnkv6Hmga8KICAgICAgICBvblN1Ym1pdDogKG5hbWUsIHRlbCkgPT4gewogICAgICAgICAgY29uc29sZS5sb2cobmFtZSwgdGVsKTsKICAgICAgICB9LAogICAgICB9KTsKCiAgICAgIGlmICghYXV0aC5pc1N0dWRlbnQoKSAmJiAhaGl0Q29tcG9uZW50LmdldCgnaXNIaXQnKSkgewogICAgICAgICAgaGl0Q29tcG9uZW50LnNldCgnc3RhdHVzJywgMCk7CiAgICAgIH0KICAgIH0sCgogICAgY3JlYXRlTG90dGVyeSgpIHsKICAgICAgY29uc29sZS5sb2coImNyZWF0ZSBsb3R0ZXJ5LiIpOwogICAgICBpZiAoYXV0aC5pc1RlYWNoZXIoKSkgewogICAgICAgIHRoaXMubG90dGVyeSA9IG51bGw7CiAgICAgICAgdGhpcy5sb3R0ZXJ5ID0gQkpZLkxvdHRlcnkuY3JlYXRlKHsKICAgICAgICAgIHJlcGxhY2U6IGZhbHNlLAogICAgICAgICAgZWxlbWVudDogJCgiI2xvdHRlcnkgLnBsYWNlaG9sZGVyIiksCiAgICAgICAgICAvLyDlj6/ku6XkvKDlhaXoh6rlrprkuYnnmq7ogqTph43lhpnmoLflvI8g6buY6K6k57qi6ImyCiAgICAgICAgICBza2luOiAicmVkIiwKICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5sb3R0ZXJ5Lm9uKCJyZWZyZXNoIiwgZnVuY3Rpb24gKCkgewogICAgICAgICAgLy8g5oq95aWW5qih5byP5pu05pawIOWIh+aNouagh+WHhuaKveWlluaIluiAheWPo+S7pOaKveWllgogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["Lottery.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqCA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Lottery.vue","sourceRoot":"src/components/ModalPanel","sourcesContent":["<!-- 模态框组件：在老师端发起各种互动后弹出 -->\n<!-- 如：点名、答题等 -->\n\n<template>\n  <div\n    v-show=\"visible\"\n    id=\"bjy-lottery\"\n    :class=\"{ 'command-lottery-hint': commandLotteryDuration }\"\n  >\n    <div v-if=\"!commandLotteryDuration\" class=\"mask\"></div>\n    <div class=\"lottery-wrap\">\n      <div id=\"lottery\">\n        <div class=\"placeholder\"></div>\n        <div class=\"bjy-close\" @click=\"close\">X</div>\n      </div>\n\n      <div id=\"lottery-hit\">\n        <div class=\"placeholder\"></div>\n      </div>\n\n      <div id=\"lottery-history\">\n        <div class=\"bjy-close\" @click=\"close\">\n          X\n        </div>\n        <div class=\"placeholder\"></div>\n      </div>\n    </div>\n\n    <div v-if=\"commandLotteryDuration\" class=\"command-lottery-count\">\n      <p>抽奖中，剩余{{ commandLotteryDuration }}秒</p>\n      <div v-if=\"!isStudent\" class=\"btn\" @click=\"drawLottery\">现在开奖</div>\n      <div v-else>聊天框输入{{ lotteryCommand }}参与抽奖</div>\n    </div>\n  </div>\n</template>\n\n<script>\nconst eventEmitter = BJY.eventEmitter;\nconst auth = BJY.auth;\n\nexport default {\n  data() {\n    return {\n      visible: false,\n      commandLotteryDuration: 0,\n      lotteryTimer: null,\n      isStudent: auth.isStudent(),\n      lotteryCommand: \"\",\n      lottery: null,\n    };\n  },\n  created() {\n    BJY.Lottery.init();\n    eventEmitter\n      .on(eventEmitter.LOTTERY_HISTORY_RES, (event, data) => {\n        this.show();\n        $(\"#lottery\").hide();\n        $(\"#lottery-history\").show();\n        // 查看中奖纪录\n        var historyComponent = BJY.LotteryHistory.create({\n          replace: false,\n          element: $(\"#lottery-history .placeholder\"),\n          list: data.history,\n          roomId: +BJY.store.get(\"class.id\"),\n        });\n      })\n      //   标准抽奖\n      .on(eventEmitter.STANDARD_LOTTERY_BEGIN, () => {\n        this.show();\n      })\n      .on(eventEmitter.STANDARD_LOTTERY_BEGIN_TRIGGER, () => {\n        $(\"#lottery\").hide();\n      })\n      .on(eventEmitter.STANDARD_LOTTERY_END, (event, data) => {\n        this.show();\n        this.createHitList(data);\n      })\n      // 口令抽奖\n      .on(eventEmitter.COMMAND_LOTTERY_ABORT, (event, data) => {\n        this.show();\n        this.createHitList(data);\n      })\n      .on(eventEmitter.COMMAND_LOTTERY_END_TRIGGER, (event, data) => {\n        this.commandLotteryDuration = 0;\n        $(\"#lottery\").hide();\n        console.log(\"command lottery end.\");\n      })\n      .on(eventEmitter.COMMAND_LOTTERY_BEIGIN, (e, data) => {\n        $(\"#lottery\").hide();\n        this.show();\n        console.log(data);\n        this.commandLotteryDuration = data.duration;\n        this.lotteryCommand = data.command;\n        if (this.lotteryTimer) {\n          clearInterval(this.lotteryTimer);\n          this.lotteryTimer = null;\n        }\n        this.lotteryTimer = setInterval(() => {\n          if (this.commandLotteryDuration > 0) {\n            --this.commandLotteryDuration;\n          } else {\n            auth.isTeacher() && this.drawLottery();\n            clearInterval(this.lotteryTimer);\n            this.lotteryTimer = null;\n          }\n        }, 1000);\n      })\n      .on(\"toggle_lottery\", () => {\n        this.visible = !this.visible;\n        this.createLottery();\n      });\n  },\n  mounted() {\n    this.createLottery();\n  },\n  methods: {\n    close() {\n      this.visible = false;\n      $(\"#lottery\").show();\n      $(\"#lottery-history\").hide();\n    },\n    show() {\n      this.visible = true;\n    },\n    // 口令开奖\n    drawLottery() {\n      clearInterval(this.lotteryTimer);\n      this.lotteryTimer = null;\n      this.commandLotteryDuration = 0;\n      eventEmitter.trigger(eventEmitter.COMMAND_LOTTERY_ABORT_TRIGGER);\n    },\n    // 中奖名单\n    createHitList(data) {\n      $(\"#lottery\").hide();\n      $(\"#lottery-hit\").show();\n      var hitComponent = BJY.LotteryHit.create({\n        element: $(\"#lottery-hit .placeholder\"),\n        list: data.hitList,\n        replace: false,\n        lotteryName: data.lotteryName,\n        onClose: () => {\n          console.log(\"lottery close.\");\n          $(\"#lottery-hit\").hide();\n          $(\"#lottery\").show();\n          this.close();\n        },\n        // 中奖者填写信息\n        onSubmit: (name, tel) => {\n          console.log(name, tel);\n        },\n      });\n\n      if (!auth.isStudent() && !hitComponent.get('isHit')) {\n          hitComponent.set('status', 0);\n      }\n    },\n\n    createLottery() {\n      console.log(\"create lottery.\");\n      if (auth.isTeacher()) {\n        this.lottery = null;\n        this.lottery = BJY.Lottery.create({\n          replace: false,\n          element: $(\"#lottery .placeholder\"),\n          // 可以传入自定义皮肤重写样式 默认红色\n          skin: \"red\",\n        });\n\n        this.lottery.on(\"refresh\", function () {\n          // 抽奖模式更新 切换标准抽奖或者口令抽奖\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n#bjy-lottery {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  box-shadow: none;\n  z-index: 11;\n  transform: none;\n\n  &.command-lottery-hint {\n    left: 10px;\n    padding: 10px;\n    bottom: 100px;\n    top: unset;\n    width: 240px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    background: #fff;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n  }\n\n  #lottery-history {\n    background: #fff;\n  }\n\n  .mask {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    z-index: 0;\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  .lottery-wrap {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n\n    .bjy-close {\n      position: absolute;\n      top: -10px;\n      right: -20px;\n      color: #fff;\n      font-size: 20px;\n      cursor: pointer;\n    }\n  }\n\n  .command-lottery-count {\n    .btn {\n      background: #1795ff;\n      color: #fff;\n      padding: 0 20px;\n      line-height: 30px;\n      height: 30px;\n      cursor: pointer;\n    }\n  }\n}\n</style>\n"]}]}
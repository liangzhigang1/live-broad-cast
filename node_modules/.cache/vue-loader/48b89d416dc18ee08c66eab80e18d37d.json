{"remainingRequest":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/WhiteBoard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/WhiteBoard.vue","mtime":1611227050000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":1584009001591},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/babel-loader/lib/index.js","mtime":1615566678361},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":1584009001591},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js","mtime":1615566687412}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmNvbnN0IGV2ZW50RW1pdHRlciA9IEJKWS5ldmVudEVtaXR0ZXI7CmNvbnN0IGF1dGggPSBCSlkuYXV0aDsKY29uc3Qgc3RvcmUgPSBCSlkuc3RvcmU7CmNvbnN0IGNvbmZpZyA9IEJKWS5jb25maWc7CgpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czoge30sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNhblByZVBhZ2U6IGZhbHNlLAogICAgICBjYW5OZXh0UGFnZTogZmFsc2UsCiAgICAgIHBhZ2VEYXRhOiBudWxsLAogICAgICBmb3JiaWRDaGFuZ2U6IHRydWUsCiAgICAgIGlzVGVhY2hlcjogYXV0aC5pc1RlYWNoZXIoKSwKICAgICAgY2FuU3R1ZGVudFBhbml0OiBmYWxzZQogICAgfTsKICB9LAogIGNvbXB1dGVkOiB7CiAgICBjYW5DaGFuZ2VQYWdlKCkgewogICAgICByZXR1cm4gYXV0aC5pc1RlYWNoZXIoKSB8fCAhdGhpcy5mb3JiaWRDaGFuZ2U7CiAgICB9LAogICAgY2FuUGFpbnQoKSB7CiAgICAgIHJldHVybiBhdXRoLmlzVGVhY2hlcigpIHx8IHRoaXMuY2FuU3R1ZGVudFBhbml0OwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgc2V0UGFnZUF1dGgoKSB7CiAgICAgIHZhciBwcmVQYWdlID0gJCgiLmljb24tY2hldnJvbi1sZWZ0Iik7CiAgICAgIHZhciBuZXh0UGFnZSA9ICQoIi5pY29uLWNoZXZyb24tcmlnaHQiKTsKCiAgICAgIGlmICh0aGlzLmNhblByZVBhZ2UpIHsKICAgICAgICBwcmVQYWdlLmFkZENsYXNzKCJoYXMtcGFnZSIpOwogICAgICB9IGVsc2UgewogICAgICAgIHByZVBhZ2UucmVtb3ZlQ2xhc3MoImhhcy1wYWdlIik7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuY2FuTmV4dFBhZ2UpIHsKICAgICAgICBuZXh0UGFnZS5hZGRDbGFzcygiaGFzLXBhZ2UiKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0UGFnZS5yZW1vdmVDbGFzcygiaGFzLXBhZ2UiKTsKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnBhZ2VEYXRhID0gQkpZLmRhdGEucGFnZTsKICAgIHRoaXMuY2FuUHJlUGFnZSA9IHRoaXMucGFnZURhdGEuZ2V0Q2xpZW50UGFnZSgpID4gMDsKICAgIHRoaXMuY2FuTmV4dFBhZ2UgPSB0aGlzLnBhZ2VEYXRhLmdldENsaWVudFBhZ2UoKSA8IHRoaXMucGFnZURhdGEuZ2V0TWF4UGFnZTsKICB9LAogIG1vdW50ZWQoKSB7CiAgICB2YXIgZWxlbWVudCA9ICQoIiN3aGl0ZWJvYXJkIik7CgogICAgLy8g5paH5qGj55m95p2/CiAgICBCSlkuV2hpdGVib2FyZC5jcmVhdGUoewogICAgICBlbGVtZW50OiBlbGVtZW50LmZpbmQoIi5wbGFjZWhvbGRlciIpLAogICAgICBmaXQ6IDEsIC8vIDEg6Ieq6YCC5bqUICAyIOaSkea7oeWuueWZqAogICAgfSk7CgogICAgLy8g55S756yU5bel5YW3CiAgICBCSlkuUGFpbnRlclRvb2xCYXIuY3JlYXRlKHsKICAgICAgICAvLyBET00g54i25YWD57SgCiAgICAgICAgZWxlbWVudDogJCgiLmJqeS10b29sYmFyLXBsYWNlaG9sZGVyIiksCiAgICAgICAgcmVwbGFjZTogdHJ1ZSwKICAgICAgICAvLyDmmK/lkKbmsLTlubPmlL7nva4KICAgICAgICBpc1ZlcnRpY2FsOiBmYWxzZSwKICAgICAgICAvLyDmmK/lkKbkvb/nlKjpgInmi6nlt6XlhbcKICAgICAgICBjYW5Vc2VTZWxlY3RUb29sOiB0cnVlLAogICAgICAgIC8v5piv5ZCm5L2/55So57KJ56yU5bel5YW3CiAgICAgICAgY2FuVXNlUGVuY2lsVG9vbDogdHJ1ZSwKICAgICAgICAvL+aYr+WQpuS9v+eUqOWbvuW9ouW3peWFtwogICAgICAgIGNhblVzZVNoYXBlVG9vbDogdHJ1ZSwKICAgICAgICAvL+aYr+WQpuS9v+eUqOaWh+acrOW3peWFtwogICAgICAgIGNhblVzZUZvbnRUb29sOiB0cnVlLAogICAgICAgIC8v5piv5ZCm5pyJ6LCD6Imy5p2/CiAgICAgICAgY2FuVXNlUGFsZXR0ZVRvb2w6IHRydWUsCiAgICAgICAgLy/mmK/lkKbkvb/nlKjliKDpmaTplK4KICAgICAgICBjYW5Vc2VEZWxldGVUb29sOiB0cnVlLAogICAgICAgIC8v5piv5ZCm5L2/55So5r+A5YWJ56yUCiAgICAgICAgY2FuVXNlUG9pbnRUb29sOiB0cnVlLAogICAgICB9KTsKCiAgICB0aGlzLnNldFBhZ2VBdXRoKCk7CgogICAgLy8g55m95p2/5bel5YW35LqL5Lu2CiAgICBlbGVtZW50LmZpbmQoIi5wcmUtcGFnZSIpLm9uKCJjbGljayIsICgpID0+IHsKICAgICAgaWYgKHRoaXMuY2FuUHJlUGFnZSAmJiB0aGlzLmNhbkNoYW5nZVBhZ2UpIHsKICAgICAgICBldmVudEVtaXR0ZXIudHJpZ2dlcihldmVudEVtaXR0ZXIuUEFHRV9QUkVWX1RSSUdHRVIpOwogICAgICB9CiAgICB9KTsKCiAgICBlbGVtZW50LmZpbmQoIi5uZXh0LXBhZ2UiKS5vbigiY2xpY2siLCAoKSA9PiB7CiAgICAgIGlmICh0aGlzLmNhbk5leHRQYWdlICYmIHRoaXMuY2FuQ2hhbmdlUGFnZSkgewogICAgICAgIGV2ZW50RW1pdHRlci50cmlnZ2VyKGV2ZW50RW1pdHRlci5QQUdFX05FWFRfVFJJR0dFUik7CiAgICAgIH0KICAgIH0pOwoKICAgIGV2ZW50RW1pdHRlcgogICAgICAub24oZXZlbnRFbWl0dGVyLldISVRFQk9BUkRfTEFZT1VUX0NIQU5HRSwgKGUsIGRhdGEpID0+IHsKICAgICAgICAvLyDph43mlrDorr7nva7nmb3mnb/nmoTpq5jluqblubborqnlhbblsYXkuK0KICAgICAgfSkKICAgICAgLm9uKGV2ZW50RW1pdHRlci5DTElFTlRfUEFHRV9DSEFOR0UsICgpID0+IHsKICAgICAgICBjb25zb2xlLmxvZygi5a6i5oi356uv57+76aG1Iik7CiAgICAgIH0pCiAgICAgIC5vbihldmVudEVtaXR0ZXIuUEFHRV9DSEFOR0VfRU5ELCAoZSwgZGF0YSkgPT4gewogICAgICAgIHZhciBjdXJyZW50UGFnZSA9IHRoaXMucGFnZURhdGEuZ2V0Q2xpZW50UGFnZSgpOwogICAgICAgIHZhciBtYXhQYWdlID0gdGhpcy5wYWdlRGF0YS5nZXRNYXhQYWdlKCk7CgogICAgICAgIGlmIChjdXJyZW50UGFnZSA+IDApIHsKICAgICAgICAgIHRoaXMuY2FuUHJlUGFnZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuY2FuUHJlUGFnZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoY3VycmVudFBhZ2UgPCBtYXhQYWdlKSB7CiAgICAgICAgICB0aGlzLmNhbk5leHRQYWdlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5jYW5OZXh0UGFnZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICB0aGlzLnNldFBhZ2VBdXRoKCk7CiAgICAgIH0pCiAgICAgIC5vbihldmVudEVtaXR0ZXIuU1RVREVOVF9QUFRfQVVUSF9DSEFOR0UsIChlLCBkYXRhKSA9PiB7CiAgICAgICAgY29uc29sZS5sb2coZGF0YS5mb3JiaWQpOwogICAgICAgIHRoaXMuZm9yYmlkQ2hhbmdlID0gZGF0YS5mb3JiaWQ7CiAgICAgIH0pCiAgICAgIC5vbihldmVudEVtaXR0ZXIuU1dJVENIX1NUVURFTlRfUEFJTlQsIChlLCBkYXRhKSA9PiB7CiAgICAgICAgaWYgKGF1dGguaXNTdHVkZW50KCkpIHsKICAgICAgICAgIHZhciBhdXRoTGlzdCA9IGRhdGEuc3R1ZGVudFBhaW50QXV0aDsKICAgICAgICAgIGF1dGhMaXN0LmZpbHRlcih1c2VyTnVtYmVyID0+IHsKICAgICAgICAgICAgcmV0dXJuIHN0b3JlLmdldCgndXNlci5udW1iZXInKSA9PT0gdXNlck51bWJlcjsKICAgICAgICAgIH0pCiAgICAgICAgICB0aGlzLmNhblN0dWRlbnRQYW5pdCA9IGF1dGhMaXN0Lmxlbmd0aCA+IDA7CiAgICAgICAgICBldmVudEVtaXR0ZXIudHJpZ2dlcigKICAgICAgICAgICAgICBldmVudEVtaXR0ZXIuUEFJTlRfQVVUSF9DSEFOR0UsCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBjYW5QYWludDogdGhpcy5jYW5TdHVkZW50UGFuaXQsCiAgICAgICAgICAgICAgICAgIGZyb21UZWFjaGVyOiB0cnVlLAogICAgICAgICAgICAgICAgICBjYWNoZTogMQogICAgICAgICAgICAgIH0KICAgICAgICAgICk7CiAgICAgICAgfQogICAgICB9KQogICAgICAub24oZXZlbnRFbWl0dGVyLk1FRElBX1BVQkxJU0gsIChlLCBkYXRhKSA9PiB7CiAgICAgICAgaWYgKGRhdGEuYXVkaW9PbiA9PT0gZmFsc2UgJiYgZGF0YS52aWRlb09uID09PSBmYWxzZSAmJiBkYXRhLnVzZXIuaWQgPT0gc3RvcmUuZ2V0KCd1c2VyLmlkJykpIHsKICAgICAgICAgIHRoaXMuY2FuU3R1ZGVudFBhbml0ID0gZmFsc2UKICAgICAgICB9CiAgICAgIH0pOwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHt9LAp9Owo="},{"version":3,"sources":["WhiteBoard.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"WhiteBoard.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"whiteboard\">\n    <div class=\"placeholder\"></div>\n    <div v-if=\"canChangePage\" class=\"pre-page\">\n      <span class=\"icon-chevron-left\" :class=\"{ forbid: !canPrePage }\"><</span>\n    </div>\n    <div v-if=\"canChangePage\" class=\"next-page\">\n      <span class=\"icon-chevron-right\" :class=\"{ forbid: !canNextPage }\">></span>\n    </div>\n\n    <div v-show=\"canPaint\" class=\"bjy-toolbar\">\n      <div class=\"bjy-toolbar-placeholder\">\n        \n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nconst eventEmitter = BJY.eventEmitter;\nconst auth = BJY.auth;\nconst store = BJY.store;\nconst config = BJY.config;\n\nexport default {\n  components: {},\n  data() {\n    return {\n      canPrePage: false,\n      canNextPage: false,\n      pageData: null,\n      forbidChange: true,\n      isTeacher: auth.isTeacher(),\n      canStudentPanit: false\n    };\n  },\n  computed: {\n    canChangePage() {\n      return auth.isTeacher() || !this.forbidChange;\n    },\n    canPaint() {\n      return auth.isTeacher() || this.canStudentPanit;\n    }\n  },\n  methods: {\n    setPageAuth() {\n      var prePage = $(\".icon-chevron-left\");\n      var nextPage = $(\".icon-chevron-right\");\n\n      if (this.canPrePage) {\n        prePage.addClass(\"has-page\");\n      } else {\n        prePage.removeClass(\"has-page\");\n      }\n      if (this.canNextPage) {\n        nextPage.addClass(\"has-page\");\n      } else {\n        nextPage.removeClass(\"has-page\");\n      }\n    },\n  },\n  created() {\n    this.pageData = BJY.data.page;\n    this.canPrePage = this.pageData.getClientPage() > 0;\n    this.canNextPage = this.pageData.getClientPage() < this.pageData.getMaxPage;\n  },\n  mounted() {\n    var element = $(\"#whiteboard\");\n\n    // 文档白板\n    BJY.Whiteboard.create({\n      element: element.find(\".placeholder\"),\n      fit: 1, // 1 自适应  2 撑满容器\n    });\n\n    // 画笔工具\n    BJY.PainterToolBar.create({\n        // DOM 父元素\n        element: $(\".bjy-toolbar-placeholder\"),\n        replace: true,\n        // 是否水平放置\n        isVertical: false,\n        // 是否使用选择工具\n        canUseSelectTool: true,\n        //是否使用粉笔工具\n        canUsePencilTool: true,\n        //是否使用图形工具\n        canUseShapeTool: true,\n        //是否使用文本工具\n        canUseFontTool: true,\n        //是否有调色板\n        canUsePaletteTool: true,\n        //是否使用删除键\n        canUseDeleteTool: true,\n        //是否使用激光笔\n        canUsePointTool: true,\n      });\n\n    this.setPageAuth();\n\n    // 白板工具事件\n    element.find(\".pre-page\").on(\"click\", () => {\n      if (this.canPrePage && this.canChangePage) {\n        eventEmitter.trigger(eventEmitter.PAGE_PREV_TRIGGER);\n      }\n    });\n\n    element.find(\".next-page\").on(\"click\", () => {\n      if (this.canNextPage && this.canChangePage) {\n        eventEmitter.trigger(eventEmitter.PAGE_NEXT_TRIGGER);\n      }\n    });\n\n    eventEmitter\n      .on(eventEmitter.WHITEBOARD_LAYOUT_CHANGE, (e, data) => {\n        // 重新设置白板的高度并让其居中\n      })\n      .on(eventEmitter.CLIENT_PAGE_CHANGE, () => {\n        console.log(\"客户端翻页\");\n      })\n      .on(eventEmitter.PAGE_CHANGE_END, (e, data) => {\n        var currentPage = this.pageData.getClientPage();\n        var maxPage = this.pageData.getMaxPage();\n\n        if (currentPage > 0) {\n          this.canPrePage = true;\n        } else {\n          this.canPrePage = false;\n        }\n        if (currentPage < maxPage) {\n          this.canNextPage = true;\n        } else {\n          this.canNextPage = false;\n        }\n        this.setPageAuth();\n      })\n      .on(eventEmitter.STUDENT_PPT_AUTH_CHANGE, (e, data) => {\n        console.log(data.forbid);\n        this.forbidChange = data.forbid;\n      })\n      .on(eventEmitter.SWITCH_STUDENT_PAINT, (e, data) => {\n        if (auth.isStudent()) {\n          var authList = data.studentPaintAuth;\n          authList.filter(userNumber => {\n            return store.get('user.number') === userNumber;\n          })\n          this.canStudentPanit = authList.length > 0;\n          eventEmitter.trigger(\n              eventEmitter.PAINT_AUTH_CHANGE,\n              {\n                  canPaint: this.canStudentPanit,\n                  fromTeacher: true,\n                  cache: 1\n              }\n          );\n        }\n      })\n      .on(eventEmitter.MEDIA_PUBLISH, (e, data) => {\n        if (data.audioOn === false && data.videoOn === false && data.user.id == store.get('user.id')) {\n          this.canStudentPanit = false\n        }\n      });\n  },\n  beforeDestroy() {},\n};\n</script>\n\n<style lang=\"scss\">\n//@import url(); 引入公共css类\n/*白板样式*/\n#whiteboard {\n  position: absolute;\n  top: 0;\n  bottom: 0;\n  left: 30px;\n  right: 30px;\n\n  .bjy-toolbar {\n    position: absolute;\n    bottom: 0;\n  }\n\n  /*白板工具*/\n  .next-page,\n  .pre-page {\n    position: absolute;\n    width: 30px;\n    top: 0;\n    bottom: 0;\n    transition: background-color 0.5s;\n    color: transparent;\n\n    .forbid:hover {\n      cursor: not-allowed;\n    }\n  }\n  .pre-page {\n    left: -30px;\n  }\n  .next-page {\n    right: -30px;\n  }\n  .pre-page:hover {\n    background-color: rgba(0, 0, 0, 0.4);\n  }\n  .next-page:hover {\n    background-color: rgba(0, 0, 0, 0.4);\n  }\n  .icon-chevron-left,\n  .icon-chevron-right {\n    font-size: 40px;\n    position: absolute;\n    top: 50%;\n    margin-top: -25px;\n    color: #fff;\n  }\n  .has-page {\n    cursor: pointer;\n  }\n}\n</style>\n"]}]}
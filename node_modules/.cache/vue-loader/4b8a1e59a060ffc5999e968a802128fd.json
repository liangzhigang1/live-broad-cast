{"remainingRequest":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/ModalPanel/Lottery.vue?vue&type=style&index=0&id=53eeebbe&lang=scss&scoped=true&","dependencies":[{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/ModalPanel/Lottery.vue","mtime":1611227050000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNianktbG90dGVyeSB7CiAgcG9zaXRpb246IGFic29sdXRlOwogIGxlZnQ6IDA7CiAgcmlnaHQ6IDA7CiAgYm90dG9tOiAwOwogIHRvcDogMDsKICBib3gtc2hhZG93OiBub25lOwogIHotaW5kZXg6IDExOwogIHRyYW5zZm9ybTogbm9uZTsKCiAgJi5jb21tYW5kLWxvdHRlcnktaGludCB7CiAgICBsZWZ0OiAxMHB4OwogICAgcGFkZGluZzogMTBweDsKICAgIGJvdHRvbTogMTAwcHg7CiAgICB0b3A6IHVuc2V0OwogICAgd2lkdGg6IDI0MHB4OwogICAgZGlzcGxheTogZmxleDsKICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsKICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgYm94LXNoYWRvdzogMCAycHggNnB4IHJnYmEoMCwgMCwgMCwgMC4yNSk7CiAgfQoKICAjbG90dGVyeS1oaXN0b3J5IHsKICAgIGJhY2tncm91bmQ6ICNmZmY7CiAgfQoKICAubWFzayB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiAwOwogICAgcmlnaHQ6IDA7CiAgICBib3R0b206IDA7CiAgICB0b3A6IDA7CiAgICB6LWluZGV4OiAwOwogICAgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjIpOwogIH0KCiAgLmxvdHRlcnktd3JhcCB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICBsZWZ0OiA1MCU7CiAgICB0b3A6IDUwJTsKICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwoKICAgIC5ianktY2xvc2UgewogICAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICAgIHRvcDogLTEwcHg7CiAgICAgIHJpZ2h0OiAtMjBweDsKICAgICAgY29sb3I6ICNmZmY7CiAgICAgIGZvbnQtc2l6ZTogMjBweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQogIH0KCiAgLmNvbW1hbmQtbG90dGVyeS1jb3VudCB7CiAgICAuYnRuIHsKICAgICAgYmFja2dyb3VuZDogIzE3OTVmZjsKICAgICAgY29sb3I6ICNmZmY7CiAgICAgIHBhZGRpbmc6IDAgMjBweDsKICAgICAgbGluZS1oZWlnaHQ6IDMwcHg7CiAgICAgIGhlaWdodDogMzBweDsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQogIH0KfQo="},{"version":3,"sources":["Lottery.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Lottery.vue","sourceRoot":"src/components/ModalPanel","sourcesContent":["<!-- 模态框组件：在老师端发起各种互动后弹出 -->\n<!-- 如：点名、答题等 -->\n\n<template>\n  <div\n    v-show=\"visible\"\n    id=\"bjy-lottery\"\n    :class=\"{ 'command-lottery-hint': commandLotteryDuration }\"\n  >\n    <div v-if=\"!commandLotteryDuration\" class=\"mask\"></div>\n    <div class=\"lottery-wrap\">\n      <div id=\"lottery\">\n        <div class=\"placeholder\"></div>\n        <div class=\"bjy-close\" @click=\"close\">X</div>\n      </div>\n\n      <div id=\"lottery-hit\">\n        <div class=\"placeholder\"></div>\n      </div>\n\n      <div id=\"lottery-history\">\n        <div class=\"bjy-close\" @click=\"close\">\n          X\n        </div>\n        <div class=\"placeholder\"></div>\n      </div>\n    </div>\n\n    <div v-if=\"commandLotteryDuration\" class=\"command-lottery-count\">\n      <p>抽奖中，剩余{{ commandLotteryDuration }}秒</p>\n      <div v-if=\"!isStudent\" class=\"btn\" @click=\"drawLottery\">现在开奖</div>\n      <div v-else>聊天框输入{{ lotteryCommand }}参与抽奖</div>\n    </div>\n  </div>\n</template>\n\n<script>\nconst eventEmitter = BJY.eventEmitter;\nconst auth = BJY.auth;\n\nexport default {\n  data() {\n    return {\n      visible: false,\n      commandLotteryDuration: 0,\n      lotteryTimer: null,\n      isStudent: auth.isStudent(),\n      lotteryCommand: \"\",\n      lottery: null,\n    };\n  },\n  created() {\n    BJY.Lottery.init();\n    eventEmitter\n      .on(eventEmitter.LOTTERY_HISTORY_RES, (event, data) => {\n        this.show();\n        $(\"#lottery\").hide();\n        $(\"#lottery-history\").show();\n        // 查看中奖纪录\n        var historyComponent = BJY.LotteryHistory.create({\n          replace: false,\n          element: $(\"#lottery-history .placeholder\"),\n          list: data.history,\n          roomId: +BJY.store.get(\"class.id\"),\n        });\n      })\n      //   标准抽奖\n      .on(eventEmitter.STANDARD_LOTTERY_BEGIN, () => {\n        this.show();\n      })\n      .on(eventEmitter.STANDARD_LOTTERY_BEGIN_TRIGGER, () => {\n        $(\"#lottery\").hide();\n      })\n      .on(eventEmitter.STANDARD_LOTTERY_END, (event, data) => {\n        this.show();\n        this.createHitList(data);\n      })\n      // 口令抽奖\n      .on(eventEmitter.COMMAND_LOTTERY_ABORT, (event, data) => {\n        this.show();\n        this.createHitList(data);\n      })\n      .on(eventEmitter.COMMAND_LOTTERY_END_TRIGGER, (event, data) => {\n        this.commandLotteryDuration = 0;\n        $(\"#lottery\").hide();\n        console.log(\"command lottery end.\");\n      })\n      .on(eventEmitter.COMMAND_LOTTERY_BEIGIN, (e, data) => {\n        $(\"#lottery\").hide();\n        this.show();\n        console.log(data);\n        this.commandLotteryDuration = data.duration;\n        this.lotteryCommand = data.command;\n        if (this.lotteryTimer) {\n          clearInterval(this.lotteryTimer);\n          this.lotteryTimer = null;\n        }\n        this.lotteryTimer = setInterval(() => {\n          if (this.commandLotteryDuration > 0) {\n            --this.commandLotteryDuration;\n          } else {\n            auth.isTeacher() && this.drawLottery();\n            clearInterval(this.lotteryTimer);\n            this.lotteryTimer = null;\n          }\n        }, 1000);\n      })\n      .on(\"toggle_lottery\", () => {\n        this.visible = !this.visible;\n        this.createLottery();\n      });\n  },\n  mounted() {\n    this.createLottery();\n  },\n  methods: {\n    close() {\n      this.visible = false;\n      $(\"#lottery\").show();\n      $(\"#lottery-history\").hide();\n    },\n    show() {\n      this.visible = true;\n    },\n    // 口令开奖\n    drawLottery() {\n      clearInterval(this.lotteryTimer);\n      this.lotteryTimer = null;\n      this.commandLotteryDuration = 0;\n      eventEmitter.trigger(eventEmitter.COMMAND_LOTTERY_ABORT_TRIGGER);\n    },\n    // 中奖名单\n    createHitList(data) {\n      $(\"#lottery\").hide();\n      $(\"#lottery-hit\").show();\n      var hitComponent = BJY.LotteryHit.create({\n        element: $(\"#lottery-hit .placeholder\"),\n        list: data.hitList,\n        replace: false,\n        lotteryName: data.lotteryName,\n        onClose: () => {\n          console.log(\"lottery close.\");\n          $(\"#lottery-hit\").hide();\n          $(\"#lottery\").show();\n          this.close();\n        },\n        // 中奖者填写信息\n        onSubmit: (name, tel) => {\n          console.log(name, tel);\n        },\n      });\n\n      if (!auth.isStudent() && !hitComponent.get('isHit')) {\n          hitComponent.set('status', 0);\n      }\n    },\n\n    createLottery() {\n      console.log(\"create lottery.\");\n      if (auth.isTeacher()) {\n        this.lottery = null;\n        this.lottery = BJY.Lottery.create({\n          replace: false,\n          element: $(\"#lottery .placeholder\"),\n          // 可以传入自定义皮肤重写样式 默认红色\n          skin: \"red\",\n        });\n\n        this.lottery.on(\"refresh\", function () {\n          // 抽奖模式更新 切换标准抽奖或者口令抽奖\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n#bjy-lottery {\n  position: absolute;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  top: 0;\n  box-shadow: none;\n  z-index: 11;\n  transform: none;\n\n  &.command-lottery-hint {\n    left: 10px;\n    padding: 10px;\n    bottom: 100px;\n    top: unset;\n    width: 240px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n    background: #fff;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);\n  }\n\n  #lottery-history {\n    background: #fff;\n  }\n\n  .mask {\n    position: absolute;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    top: 0;\n    z-index: 0;\n    background: rgba(0, 0, 0, 0.2);\n  }\n\n  .lottery-wrap {\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n\n    .bjy-close {\n      position: absolute;\n      top: -10px;\n      right: -20px;\n      color: #fff;\n      font-size: 20px;\n      cursor: pointer;\n    }\n  }\n\n  .command-lottery-count {\n    .btn {\n      background: #1795ff;\n      color: #fff;\n      padding: 0 20px;\n      line-height: 30px;\n      height: 30px;\n      cursor: pointer;\n    }\n  }\n}\n</style>\n"]}]}
{"remainingRequest":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/TeacherPlayer.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/TeacherPlayer.vue","mtime":1611227050000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiNsaXZlLXRlYWNoZXItcGxheWVyIHsKICB3aWR0aDogMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgcG9zaXRpb246IHJlbGF0aXZlOwp9Cg=="},{"version":3,"sources":["TeacherPlayer.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0MA;AACA;AACA;AACA;AACA","file":"TeacherPlayer.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div id=\"live-teacher-player\"></div>\n</template>\n\n<script>\nconst store = BJY.store;\nconst auth = BJY.auth;\nconst eventEmitter = BJY.eventEmitter;\nconst userData = BJY.data.user;\nconst config = BJY.config;\n\nexport default {\n  components: {},\n  data() {\n    return {\n      player: null,\n    };\n  },\n  methods: {\n    //创建老师播放器\n    createTeacherPlayer(isWebRTCMix) {\n      if (isWebRTCMix === undefined) {\n        isWebRTCMix = auth.isWebRTC();\n      }\n      isWebRTCMix && (store.get('webrtcMixUser').name = '老师');\n      this.player && this.player.destroy();\n      this.player = null;\n      const user = auth.isPresenter()\n        ? store.get(\"presenter\")\n        : isWebRTCMix\n        ? store.get(\"webrtcMixUser\")\n        : store.get(\"presenter\") || store.get(\"teacher\");\n      const options = {\n        element: $(\"#live-teacher-player\"),\n        replace: false,\n        user: user,\n        extension: BJY.getExtension(),\n        canSwitchCamera: auth.isSelf(store.get(\"teacher.id\")),\n        canSwitchMic: auth.isSelf(store.get(\"teacher.id\")),\n        footerOptions: {\n          onToggleClick: this.pptVideoSwitch,\n        },\n      };\n      !auth.isTeacher() && (options.isWebRTCMix = isWebRTCMix);\n      this.player = BJY.DefaultThemePlayer.create(options);\n    },\n\n    swap(presenterCameraNode, whiteboardNode) {\n      var presenterCameraParentNode = presenterCameraNode.parentNode;\n      var whiteboardParentNode = whiteboardNode.parentNode;\n      var presenterCameraPlaceholder = document.createElement(\"div\");\n      var whiteboardPlaceholder = document.createElement(\"div\");\n\n      presenterCameraParentNode.insertBefore(\n        presenterCameraPlaceholder,\n        presenterCameraNode\n      );\n      whiteboardParentNode.insertBefore(whiteboardPlaceholder, whiteboardNode);\n\n      whiteboardNode &&\n        presenterCameraParentNode.insertBefore(\n          whiteboardNode,\n          presenterCameraPlaceholder\n        );\n      presenterCameraNode &&\n        whiteboardParentNode.insertBefore(presenterCameraNode, whiteboardPlaceholder);\n\n      presenterCameraParentNode.removeChild(presenterCameraPlaceholder);\n      whiteboardParentNode.removeChild(whiteboardPlaceholder);\n    },\n\n    // 切换ppt与主讲视频位置，如需同步切换，可通过自定义信令实现\n    pptVideoSwitch() {\n      const presenterDom = $(\".bjy-player-theme-default\")[0];\n      const whiteboardDom = $(\".bjy-whiteboard\")[0];\n      this.swap(presenterDom, whiteboardDom);\n      eventEmitter.trigger(eventEmitter.WINDOW_RESIZE);\n    },\n  },\n  created() {\n    var playerInstance = this.player\n    eventEmitter\n      .on(eventEmitter.CLASS_START, (event, data) => {\n        this.createTeacherPlayer();\n        // 设置一下发言权限\n        if (auth.isTeacher() || auth.isAssistant()) {\n          store.set(\"class.speakState\", config.SPEAK_STATE_FREE);\n        }\n        // 上课后老师自动开启音视频\n        if (auth.isTeacher()) {\n          eventEmitter.trigger(eventEmitter.MEDIA_SWITCH_TRIGGER, {\n            audioOn: true,\n            videoOn: true,\n          });\n        }\n      })\n      .on(eventEmitter.MEDIA_SWITCH_TRIGGER, function (event, data) {\n        var player = BJY.Player.instances[store.get(\"user.id\")];\n        player && BJY.userPublish.setDevice(player, data.videoOn, data.audioOn);\n      })\n      .on(\n        // 老师打开媒体事件\n        eventEmitter.TEACHER_MEDIA_ON,\n        () => {\n          // 判断播放器是否存在\n          if (!this.player) {\n            this.createTeacherPlayer();\n          }\n        }\n      )\n      .on(\n        eventEmitter.MEDIA_STATUS_CHANGE,\n        (e, data) => {\n          console.log(data)\n          if (data.videoOn) {\n            !auth.isPresenter() && this.createTeacherPlayer(false)\n          } else {\n            !auth.isPresenter() && this.createTeacherPlayer(true)\n          }\n        }\n      )\n      .on(\n        // 主播关闭媒体事件\n        eventEmitter.TEACHER_MEDIA_OFF,\n        () => {\n        }\n      )\n      .on(\n        eventEmitter.CLASSROOM_CONNECT_SUCCESS,\n        () => {\n          this.createTeacherPlayer();\n        }\n      )\n    // 监听主讲人切换\n    !auth.isTeacher() &&\n      store.watch(\"presenterId\", (newPresenterId, oldPresenterId) => {\n        var newPresenter = userData.find(newPresenterId);\n        var oldPresenter = userData.find(oldPresenterId);\n        // 先处理发言列表\n        eventEmitter.ACTIVE_LIST_PRESENTER_CHANGE_TRIGGER =\n          \"active_list_presenter_change_trigger\";\n        eventEmitter.trigger(eventEmitter.ACTIVE_LIST_PRESENTER_CHANGE_TRIGGER, {\n          newPresenter: newPresenter,\n          oldPresenter: oldPresenter,\n        });\n        // 主讲播放器销毁重建，\n        if (newPresenter) {\n          if (this.player) {\n            this.createTeacherPlayer();\n          }\n        }\n      });\n\n    const doc = document.documentElement\n    // 全屏 esc 退出的问题\n    if (doc.requestFullscreen) {\n        document.addEventListener(\n            'fullscreenchange',\n            function () {\n                var isFullscreen = playerInstance && playerInstance.isFullScreen\n\n                if (document.fullscreen != isFullscreen && !document.fullscreen) {\n                    eventEmitter.trigger(\n                        eventEmitter.FULLSCREEN_EXIT_TRIGGER\n                    );\n                }\n            }\n        );\n    }\n    else if (doc.webkitRequestFullScreen) {\n        document.addEventListener(\n            'webkitfullscreenchange',\n            function () {\n                var isFullscreen = playerInstance && playerInstance.isFullScreen\n\n                if (document.webkitIsFullScreen != isFullscreen && !document.webkitIsFullScreen) {\n                    eventEmitter.trigger(\n                        eventEmitter.FULLSCREEN_EXIT_TRIGGER\n                    );\n                }\n            }\n        );\n    }\n    else if (doc.mozRequestFullScreen) {\n        document.addEventListener(\n            'mozfullscreenchange',\n            function () {\n                var isFullscreen = playerInstance && playerInstance.isFullScreen\n\n                if (document.mozFullScreen != isFullscreen && !document.mozFullScreen) {\n                    eventEmitter.trigger(\n                        eventEmitter.FULLSCREEN_EXIT_TRIGGER\n                    );\n                }\n            }\n        );\n    }\n  },\n};\n</script>\n\n<style lang=\"scss\">\n#live-teacher-player {\n  width: 100%;\n  height: 100%;\n  position: relative;\n}\n</style>\n"]}]}
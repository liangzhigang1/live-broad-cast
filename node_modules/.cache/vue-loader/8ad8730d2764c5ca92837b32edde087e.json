{"remainingRequest":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/InteractionPanel/UserList.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/src/components/InteractionPanel/UserList.vue","mtime":1611227050000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/sass-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liangzg/Downloads/bjy-live-vue-demo/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi8vQGltcG9ydCB1cmwoKSDlvJXlhaXlhazlhbFjc3PnsbsKLmJqeS11c2VyLWxheWVyIHsKICBwb3NpdGlvbjogZml4ZWQ7Cn0K"},{"version":3,"sources":["UserList.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoMA;AACA;AACA;AACA","file":"UserList.vue","sourceRoot":"src/components/InteractionPanel","sourcesContent":["<template>\n  <div id=\"user-list\"></div>\n</template>\n\n<script>\nimport userRoleMap from \"./common/roleMap\";\nlet auth = BJY.auth;\nlet config = BJY.config;\n\nexport default {\n  components: {},\n  data() {\n    return {\n      userLayerInstance: null,\n      lastUser: null,\n    };\n  },\n  computed: {},\n  watch: {},\n  methods: {\n    // 生成浮层\n    setLayer(useParameterUser, e) {\n      let ele = $(\".bjy-user-layer\");\n      if (!this.userLayerInstance || (this.userLayerInstance && !ele[0])) {\n        if (this.userLayerInstance && !ele[0]) {\n          this.userLayerInstance.destroy();\n        }\n        let node = document.createElement(\"div\");\n        $(\"#app\").append(node);\n        this.userLayerInstance = BJY.UserLayer.create({\n          user: this.lastUser,\n          element: $(node),\n          renderUser: function (user, width, height) {\n            return {\n              id: user.id,\n              name: user.name,\n              number: user.number,\n              // 头像需压缩\n              avatar: BJY.compressImage({\n                url: user.avatar,\n                width: width,\n                height: height,\n              }),\n              avatar2x: BJY.compressImage({\n                url: user.avatar,\n                width: width * 2,\n                height: height * 2,\n              }),\n              // 根据用户类型，配置角色的英文和本地语言\n              role: userRoleMap[user.type].en,\n              localRole: userRoleMap[user.type].cn,\n            };\n          },\n          useParameterUser: useParameterUser,\n          speakInviteTimeout: 10 * 1000,\n          setMediaTimeout: 10 * 1000,\n          hasSwitchPaint: function (user) {\n            if (auth.isTeacher() || auth.isAssistant()) {\n              if (auth.isStudent(user.type)) {\n                if (\n                  user.endType === config.END_TYPE_MOBILE_BROWSER ||\n                  user.endType === config.END_TYPE_XIAOCHENGXU\n                ) {\n                  return false;\n                }\n                // 大班课学生没有上麦就不要有授权画笔的按钮了\n                if (!user.videoOn && !user.audioOn) {\n                  return false;\n                }\n                return true;\n              }\n            }\n            return false;\n          },\n          hasSwitchDocumentControl: function (user) {\n            return false;\n          },\n          onKickOutConfirm: function (deferred, user, content) {\n              if (window.confirm('确定要将该学生踢出教室吗？')) {\n                  deferred.resolve(true)\n                } else {\n                  deferred.reject(false)\n                }\n                return deferred;\n          }\n        });\n      } else {\n        this.userLayerInstance.set(\"useParameterUser\", useParameterUser);\n        this.userLayerInstance.set(\"user\", this.lastUser);\n      }\n      $(\".bjy-user-layer\").css({\n        top: e.originalEvent.clientY + 10 + \"px\",\n        left: e.originalEvent.clientX - 150 + \"px\",\n      });\n\n      $(\".bjy-user-layer\").toggle();\n    },\n  },\n  created() {\n    let eventEmitter = BJY.eventEmitter;\n    // 监听人数变化\n    eventEmitter.on(eventEmitter.USER_COUNT_CHANGE, function (e, data) {\n      $(\"#user-count\").text(\"(\" + data.userCount + \")\");\n    });\n  },\n  mounted() {\n    let eventEmitter = BJY.eventEmitter;\n    let me = this;\n\n    BJY.UserList.create({\n      element: $(\"#user-list\"),\n      renderUser: function (user, width, height) {\n        return {\n          id: user.id,\n          name: user.name,\n          number: user.number,\n          // 头像需压缩\n          avatar: BJY.compressImage({\n            url: user.avatar,\n            width: width,\n            height: height,\n          }),\n          avatar2x: BJY.compressImage({\n            url: user.avatar,\n            width: width * 2,\n            height: height * 2,\n          }),\n          // 根据用户类型，配置角色的英文和本地语言\n          role: userRoleMap[user.type].en,\n          localRole: userRoleMap[user.type].cn,\n        };\n      },\n    });\n\n    // 老师端在用户列表生成操作浮层\n    if (BJY.auth.isTeacher()) {\n      // 是否允许邀请上麦\n      BJY.auth.canSpeakInvite = function (target) {\n        return BJY.auth.isTeacher() && (target ? !target.group : true);\n      };\n\n      // 是否允许强制发言（与邀请发言互斥）\n      BJY.auth.canSpeakForce = function (target) {\n        return false;\n        // 组内用户不允许被强制发言\n        return BJY.auth.isTeacher() && (target ? !target.group : true);\n      };\n      $(\".user-list\").delegate(\".bjy-user-item\", \"click\", function (e) {\n        event.stopPropagation();\n        let number = e.currentTarget.dataset.number;\n        let user = BJY.data.user.findByNumber(number);\n        // user不存在到服务器获取\n        if (!user) {\n          eventEmitter.one(eventEmitter.USER_SEARCH_RES, function (event, data) {\n            if (data.result && data.result.length > 0) {\n              user = data.result[0];\n              BJY.data.user.add(user);\n              me.lastUser = user;\n              me.setLayer(false, e);\n            }\n          });\n          eventEmitter.trigger(eventEmitter.USER_SEARCH_REQ, {\n            query: userNumber,\n            field: \"number\",\n          });\n        } else {\n          me.lastUser = user;\n          me.setLayer(false, e);\n        }\n      });\n\n      $(\"#app\").delegate(\".bjy-user-layer\", \"click\", function (event) {\n        event.stopPropagation();\n      });\n\n      $(\"#app\").click(function () {\n        $(\".bjy-user-layer\") && $(\".bjy-user-layer\").hide();\n      });\n    } else {\n      // 学生端接收邀请发言信令\n      let userSpeak = BJY.userSpeak;\n      eventEmitter.on(eventEmitter.SPEAK_INVITE_CONFIRM, function () {\n        let res = confirm(\"老师邀请你上麦发言\");\n        if (res) {\n          userSpeak.processInvite(true);\n        } else {\n          userSpeak.processInvite(false);\n        }\n      });\n    }\n  },\n  beforeDestroy() {},\n};\n</script>\n\n<style lang=\"scss\">\n//@import url() 引入公共css类\n.bjy-user-layer {\n  position: fixed;\n}\n</style>\n"]}]}